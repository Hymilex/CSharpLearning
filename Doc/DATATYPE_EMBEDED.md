## 数据类型深入

### 值类型和引用类型

- 值类型主要包括简单类型、枚举类型和结构体。
- 值类型的变量值通常分配在线程的堆栈上，变量保存的内容是实例数据的本身。



- 引用类型的实例被分配在托管堆上，变量保存的是实例数据的内存地址。
- 引用类型主要包括类类型、接口类型、委托类型和字符串类型。

---

> 不同的分配位置导致了不同的管理机制，值类型的管理由操作系统负责，引用类型的管理由垃圾回收器(Garbage Collection,GC)负责。

### 值类型和引用类型之间区别

- 值类型继承自ValueType,ValueType又继承System.Object。而引用类型直接继承与System.Object。
- 值类型的内存不受GC控制，作用域结束时会自动释放，从而减少托管堆上压力。
- 如果值类型密封，将不能把值类型作为其他任何类型的基类；而引用类型具有一般继承性，这里指的是接口和类。
- 值类型不能为null值，它会默认为0；引用类型如果为空的话，都会触发NullRefenceException。
- 值类型由于是存储值本身，值类型之间的传参不会影响变量的本身。但是引用类型是传的地址，会改变其地址所在的值 。

### 值类型和引用类型之间转换(装箱与拆箱)

​	这就是传说中吃装箱和拆箱啊。装箱指值类型转换为引用类型的过程，而拆箱是引用类型转换为值类型的过程。

```c#
    class Enchase
    {
        /// <summary>
        /// 1.内存分配
        /// 2.完成实际数据的复制
        /// 3.地址的返回
        /// </summary>
        public object ECH(int j)
        {
            int i = j;
            //装箱操作
            object o = i;

            return o;
        }
        /// <summary>
        /// 1.检查拆箱的引用类型是否为空，如果是如果是，则返回NullRefenceException
        /// 接着检查变量是否和拆箱后的类型属于同类型，如果不是，会导致InvalidCastException
        /// 2.地址返回
        /// 3.数据复制：将托管堆上数据复制到线程栈上
        /// </summary>
        /// <param name="o"></param>
        /// <returns></returns>
        public int Devanning(object o)
        {
            //强制拆箱
            int j = (int)o;
            return j;
        }
    }
```

### 四类情况

#### 值类型参数按照值传递

#### 引用类型参数按照值传递

- 这个意思是引用类型一般传的都是地址，会改变原值。

#### string引用类型按照值传递的特殊情况

- string 按照值传递，不会改变原始值。

#### 值类型和引用类型参数按照引用传递

- 这个需要借助关键字 ref 就搞定，方法的定义和调用都必须**显式的使用ref 或者out**

